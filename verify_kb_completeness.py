#!/usr/bin/env python3
"""–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Ç—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""

import re


def verify_knowledge_base(filename="KNOWLEDGE_BASE_COMPLETE.md"):
    with open(filename, encoding="utf-8") as f:
        content = f.read()

    print("=" * 80)
    print("–í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø –ü–û–õ–ù–û–¢–´ –ë–ê–ó–´ –ó–ù–ê–ù–ò–ô")
    print("=" * 80)

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
    required_sections = [
        (r"## 1\. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–º–µ–Ω–∞", "–†–∞–∑–¥–µ–ª 1: –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"),
        (r"## 2\. –¢–µ—Ä–º–∏–Ω—ã –∏ –≥–ª–æ—Å—Å–∞—Ä–∏–π", "–†–∞–∑–¥–µ–ª 2: –¢–µ—Ä–º–∏–Ω—ã"),
        (r"## 3\. –ü—Ä–æ—Ü–µ—Å—Å—ã –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã", "–†–∞–∑–¥–µ–ª 3: –ü—Ä–æ—Ü–µ—Å—Å—ã"),
        (r"## 4\. –ü—Ä–∞–≤–∏–ª–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è", "–†–∞–∑–¥–µ–ª 4: –ü—Ä–∞–≤–∏–ª–∞"),
        (r"## 5\. –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–æ—Ä–º–∞—Ç—ã", "–†–∞–∑–¥–µ–ª 5: –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö"),
        (r"## 6\. –†–æ–ª–∏ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", "–†–∞–∑–¥–µ–ª 6: –†–æ–ª–∏"),
        (r"## 7\. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è", "–†–∞–∑–¥–µ–ª 7: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏"),
        (r"## 8\. –û—à–∏–±–∫–∏, –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –∫—Ä–∞–π–Ω–∏–µ —Å–ª—É—á–∞–∏", "–†–∞–∑–¥–µ–ª 8: –û—à–∏–±–∫–∏"),
        (r"## 9\. –°–≤—è–∑–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏", "–†–∞–∑–¥–µ–ª 9: –°–≤—è–∑–∏"),
        (r"## 10\. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞", "–†–∞–∑–¥–µ–ª 10: –ò—Å—Ç–æ—á–Ω–∏–∫–∏"),
    ]

    print("\n‚úÖ –ü–†–û–í–ï–†–ö–ê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–• –†–ê–ó–î–ï–õ–û–í:\n")
    all_present = True
    for pattern, name in required_sections:
        if re.search(pattern, content):
            print(f"  ‚úì {name}")
        else:
            print(f"  ‚úó {name} - –û–¢–°–£–¢–°–¢–í–£–ï–¢!")
            all_present = False

    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    print("\nüìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–û–ù–¢–ï–ù–¢–ê:\n")

    total_lines = len(content.split("\n"))
    print(f"  –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: {total_lines:,}")

    # –ü–æ–¥—Å—á—ë—Ç —Ç–∞–±–ª–∏—Ü
    tables = len(re.findall(r"\|.*\|.*\|", content))
    print(f"  –°—Ç—Ä–æ–∫ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏: {tables:,}")

    # –ü–æ–¥—Å—á—ë—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    h1 = len(re.findall(r"^# ", content, re.MULTILINE))
    h2 = len(re.findall(r"^## ", content, re.MULTILINE))
    h3 = len(re.findall(r"^### ", content, re.MULTILINE))
    h4 = len(re.findall(r"^#### ", content, re.MULTILINE))
    print(f"  –ó–∞–≥–æ–ª–æ–≤–∫–æ–≤ H1: {h1}")
    print(f"  –ó–∞–≥–æ–ª–æ–≤–∫–æ–≤ H2: {h2}")
    print(f"  –ó–∞–≥–æ–ª–æ–≤–∫–æ–≤ H3: {h3}")
    print(f"  –ó–∞–≥–æ–ª–æ–≤–∫–æ–≤ H4: {h4}")

    # –ü–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
    sources = len(re.findall(r"`[^`]+\.md`", content))
    print(f"  –°—Å—ã–ª–æ–∫ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (.md): {sources:,}")

    # –ü–æ–¥—Å—á—ë—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤
    gost = len(re.findall(r"–ì–û–°–¢\s+\d+", content))
    iso = len(re.findall(r"ISO\s+\d+", content))
    din = len(re.findall(r"DIN\s+\d+", content))
    print(f"  –£–ø–æ–º–∏–Ω–∞–Ω–∏–π –ì–û–°–¢: {gost:,}")
    print(f"  –£–ø–æ–º–∏–Ω–∞–Ω–∏–π ISO: {iso:,}")
    print(f"  –£–ø–æ–º–∏–Ω–∞–Ω–∏–π DIN: {din:,}")

    # –û—Ü–µ–Ω–∫–∞ –æ–±—ä—ë–º–∞ —Ä–∞–∑–¥–µ–ª–æ–≤
    print("\nüìè –û–ë–™–Å–ú –†–ê–ó–î–ï–õ–û–í (—Å—Ç—Ä–æ–∫):\n")

    sections = []
    for i in range(1, 11):
        if i < 10:
            pattern = f"^## {i}\\..*?(?=^## {i+1}\\.)"
        else:
            pattern = f"^## {i}\\..*"

        match = re.search(pattern, content, re.MULTILINE | re.DOTALL)
        if match:
            section_lines = len(match.group().split("\n"))
            sections.append((i, section_lines))
            status = "‚úì –î–û–°–¢–ê–¢–û–ß–ù–û" if section_lines > 50 else "‚ö† –ú–ê–õ–û"
            print(f"  –†–∞–∑–¥–µ–ª {i}: {section_lines:,} —Å—Ç—Ä–æ–∫ - {status}")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
    print("\nüéØ –û–¶–ï–ù–ö–ê –ö–ê–ß–ï–°–¢–í–ê:\n")

    quality_checks = [
        (total_lines > 20000, "–û–±—â–∏–π –æ–±—ä—ë–º > 20,000 —Å—Ç—Ä–æ–∫"),
        (tables > 100, "–¢–∞–±–ª–∏—Ü > 100"),
        (sources > 500, "–°—Å—ã–ª–æ–∫ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ > 500"),
        (gost > 50, "–£–ø–æ–º–∏–Ω–∞–Ω–∏–π –ì–û–°–¢ > 50"),
        (all_present, "–í—Å–µ 10 —Ä–∞–∑–¥–µ–ª–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç"),
        (all(lines > 50 for _, lines in sections), "–í—Å–µ —Ä–∞–∑–¥–µ–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–µ (>50 —Å—Ç—Ä–æ–∫)"),
    ]

    passed = sum(1 for check, _ in quality_checks if check)
    total_checks = len(quality_checks)

    for check, description in quality_checks:
        status = "‚úì" if check else "‚úó"
        print(f"  {status} {description}")

    print(f"\nüìà –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê: {passed}/{total_checks} –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–æ–π–¥–µ–Ω–æ")

    if passed == total_checks:
        print("\nüéâ –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô –ü–û–õ–ù–û–°–¢–¨–Æ –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ –¢–†–ï–ë–û–í–ê–ù–ò–Ø–ú!")
    elif passed >= total_checks * 0.8:
        print("\nüëç –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º")
    else:
        print("\n‚ö†Ô∏è  –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏")

    print("=" * 80)


if __name__ == "__main__":
    verify_knowledge_base()
